<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">

<head>
  <meta charset="UTF-8" />
  <title>Dashboard Khách hàng - AURA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <style>
    /* ... Giữ nguyên CSS ... */
    :root {
      --primary-blue: #0056b3;
      --tech-cyan: #0dcaf0;
      --soft-bg: #f0f7ff;
    }

    body {
      font-family: "Nunito", sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      color: #333;
    }

    .navbar {
      background: rgba(255, 255, 255, 0.85) !important;
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
    }

    .card {
      border: none;
      border-radius: 20px;
      background: white;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .card::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
    }

    .card-upload::after {
      background: #0d6efd;
    }

    .card-ai::after {
      background: #198754;
      height: 6px;
    }

    .card-doctor::after {
      background: #0dcaf0;
    }

    .card-profile::after {
      background: #ffc107;
    }

    .card-package::after {
      background: #6c757d;
    }

    .card-support::after {
      background: #dc3545;
    }

    .card-icon {
      font-size: 3rem;
      margin-bottom: 20px;
      transition: transform 0.3s;
    }

    .card:hover .card-icon {
      transform: scale(1.1);
    }

    .text-upload {
      color: #0d6efd;
    }

    .text-ai {
      color: #198754;
    }

    .text-doctor {
      color: #0dcaf0;
    }

    .text-profile {
      color: #ffc107;
    }

    .text-package {
      color: #6c757d;
    }

    .text-support {
      color: #dc3545;
    }

    .btn-custom {
      border-radius: 50px;
      padding: 8px 25px;
      font-weight: 600;
      margin-top: auto;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #0d6efd, #0dcaf0);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-icon-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: white;
      border: 1px solid #eee;
      transition: 0.2s;
      color: #555;
    }

    .nav-icon-btn:hover {
      background-color: #f8f9fa;
      color: var(--primary-blue);
      transform: translateY(-2px);
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="#">
        <i class="fa-solid fa-eye me-2"></i>AURA
        <span class="text-secondary fw-normal fs-6 opacity-75">(SP26SE025)</span>
      </a>

      <div class="d-flex align-items-center gap-3 ms-auto">
        <a th:href="@{/customer/notifications}" class="nav-icon-btn position-relative text-decoration-none">
          <i class="fa-regular fa-bell fa-lg"></i>
          <span
            class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle visually-hidden">
            <span class="visually-hidden">New alerts</span>
          </span>
        </a>

        <div class="d-none d-md-block text-end lh-sm">
          <div class="text-muted" style="font-size: 0.8rem">Xin chào,</div>
          <div class="fw-bold text-dark"
            th:text="${currentUser.fullName != null ? currentUser.fullName : 'Khách hàng'}">
            User Name
          </div>
        </div>

        <div class="user-avatar">
          <img th:if="${currentUser.avatarPath != null}" th:src="${currentUser.avatarPath}" style="
                width: 40px;
                height: 40px;
                border-radius: 50%;
                object-fit: cover;
              " alt="Avatar" />
          <i th:if="${currentUser.avatarPath == null}" class="fa-solid fa-user"></i>
        </div>


        <form th:action="@{/logout}" method="post" class="m-0">
          <button type="submit" class="nav-icon-btn text-danger border-danger-subtle ms-2">
            <i class="fa-solid fa-power-off"></i>
          </button>
        </form>
      </div>
    </div>
  </nav>

  <div class="container main-content" style="margin-top: 100px; padding-bottom: 50px">
    <div class="text-center mb-5">
      <h2 class="fw-bold display-6">Dashboard Sàng Lọc</h2>
      <p class="text-muted">
        Quản lý sức khỏe võng mạc và theo dõi các rủi ro về mắt
      </p>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
      <div class="col">
        <div class="card card-upload p-4 text-center">
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <i class="fa-solid fa-cloud-arrow-up card-icon text-upload"></i>
            </div>
            <h5 class="card-title fw-bold">Tải Ảnh Đáy Mắt</h5>
            <p class="card-text text-muted small">
              Upload hình ảnh (Fundus/OCT) để hệ thống AI phân tích ngay.
            </p>
            <a th:href="@{/customer/reports/upload}" class="btn btn-primary btn-custom text-white">Bắt đầu <i
                class="fa-solid fa-arrow-right ms-1"></i></a>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card card-ai p-4 text-center border-success" style="background: #f0fff4">
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <i class="fa-solid fa-brain card-icon text-ai"></i>
            </div>
            <h5 class="card-title fw-bold text-success">Kết Quả AI</h5>
            <p class="card-text text-muted small">
              Xem báo cáo rủi ro, bản đồ nhiệt vùng tổn thương.
            </p>
            <a th:href="@{/customer/reports/history}" class="btn btn-success btn-custom text-white">Xem Báo Cáo</a>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card card-doctor p-4 text-center">
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <i class="fa-solid fa-user-doctor card-icon text-doctor"></i>
            </div>
            <h5 class="card-title fw-bold">Tư Vấn Chuyên Gia</h5>
            <p class="card-text text-muted small">
              Chat trực tiếp với bác sĩ để giải đáp kết quả AI.
            </p>
            <a th:href="@{/customer/doctor-chat}" class="btn btn-info btn-custom text-white">Liên hệ</a>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card card-profile p-4 text-center">
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <i class="fa-solid fa-file-waveform card-icon text-profile"></i>
            </div>
            <h5 class="card-title fw-bold">Hồ Sơ Y Tế</h5>
            <p class="card-text text-muted small">
              Cập nhật chỉ số huyết áp, tiểu đường và tiền sử bệnh.
            </p>
            <a th:href="@{/customer/profile}" class="btn btn-warning btn-custom text-dark">Cập nhật</a>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card card-package p-4 text-center">
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <i class="fa-solid fa-layer-group card-icon text-package"></i>
            </div>
            <h5 class="card-title fw-bold">Gói Dịch Vụ</h5>
            <p class="card-text text-muted small">
              Mua lượt phân tích AI hoặc xem lịch sử thanh toán.
            </p>
            <a th:href="@{/customer/packages}" class="btn btn-secondary btn-custom text-white">Mua gói</a>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card card-support p-4 text-center">
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <i class="fa-solid fa-circle-question card-icon text-support"></i>
            </div>
            <h5 class="card-title fw-bold">Hỗ Trợ & Bảng Giá</h5>
            <p class="card-text text-muted small">
              Xem bảng giá niêm yết và gửi câu hỏi thắc mắc.
            </p>
            <a th:href="@{/test-services/customer}" class="btn btn-danger btn-custom text-white">Xem ngay</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // SCRIPT ĐÃ ĐƯỢC LÀM GỌN:
    // Chỉ xử lý hiện chấm đỏ trên chuông, không hiện Toast
    document.addEventListener("DOMContentLoaded", function () {
      setTimeout(function () {
        // Tìm chấm đỏ
        const badge = document.querySelector(".fa-bell + .position-absolute");
        // Hiện chấm đỏ lên
        if (badge) {
          badge.classList.remove("visually-hidden");
          badge.classList.add("animate__animated", "animate__heartBeat");
        }
      }, 3000); // 3 giây sau khi vào trang
    });
  </script>
</body>

</html>